<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Adding Types Â· PowerSystems.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="PowerSystems.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">PowerSystems.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../../user_guide/installation/">Installation</a></li><li><a class="tocitem" href="../../user_guide/quick_start_guide/">Quick Start Guide</a></li><li><a class="tocitem" href="../../user_guide/system/">System</a></li><li><a class="tocitem" href="../../user_guide/generated_type_structure/">Type Structure</a></li></ul></li><li><span class="tocitem">Modeler</span><ul><li><a class="tocitem" href="../../modeler/parsing/">Constructing a System from raw data</a></li><li><a class="tocitem" href="../../modeler/data/">Saving and Viewing PowerSystems Data</a></li><li><a class="tocitem" href="../../modeler/example_dynamic_data/">Creating a Dynamic System</a></li><li><a class="tocitem" href="../../modeler/generated_modeling_with_JuMP/">Modeling With Jump</a></li><li><a class="tocitem" href="../../modeler/generated_network_matrices/">Network Matrices</a></li><li><a class="tocitem" href="../../modeler/generated_power_flow/">Power Flow</a></li></ul></li><li><span class="tocitem">Model Developer</span><ul><li><a class="tocitem" href="../extending_parsing/">Extending Parsing</a></li><li class="is-active"><a class="tocitem" href>Adding Types</a><ul class="internal"><li><a class="tocitem" href="#Type-Hierarchy"><span>Type Hierarchy</span></a></li><li><a class="tocitem" href="#Auto-generating-Structs"><span>Auto-generating Structs</span></a></li><li><a class="tocitem" href="#Interfaces"><span>Interfaces</span></a></li><li><a class="tocitem" href="#Specialize-an-Existing-Type"><span>Specialize an Existing Type</span></a></li><li><a class="tocitem" href="#Custom-Rules"><span>Custom Rules</span></a></li><li><a class="tocitem" href="#JSON-Serialization"><span>JSON Serialization</span></a></li></ul></li></ul></li><li><span class="tocitem">Developer</span><ul><li><a class="tocitem" href="../../developer/style/">Style Guide</a></li><li><a class="tocitem" href="../../developer/testing/">Testing</a></li><li><a class="tocitem" href="../../developer/logging/">Logging</a></li></ul></li><li><span class="tocitem">Model Library</span><ul><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">DeviceParameter</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_MultiStartCost/">MultiStartCost</a></li><li><a class="tocitem" href="../../model_library/generated_ThreePartCost/">ThreePartCost</a></li><li><a class="tocitem" href="../../model_library/generated_TwoPartCost/">TwoPartCost</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">DynamicInverterComponent</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_Converter/">Converter</a></li><li><a class="tocitem" href="../../model_library/generated_DCSource/">DCSource</a></li><li><a class="tocitem" href="../../model_library/generated_Filter/">Filter</a></li><li><a class="tocitem" href="../../model_library/generated_FrequencyEstimator/">FrequencyEstimator</a></li><li><a class="tocitem" href="../../model_library/generated_InnerControl/">InnerControl</a></li><li><a class="tocitem" href="../../model_library/outer_control/">OuterControl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">StaticInjection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_InterruptibleLoad/">InterruptibleLoad</a></li><li><a class="tocitem" href="../../model_library/generated_FixedAdmittance/">FixedAdmittance</a></li><li><a class="tocitem" href="../../model_library/generated_PowerLoad/">PowerLoad</a></li><li><a class="tocitem" href="../../model_library/generated_HydroDispatch/">HydroDispatch</a></li><li><a class="tocitem" href="../../model_library/generated_HydroEnergyReservoir/">HydroEnergyReservoir</a></li><li><a class="tocitem" href="../../model_library/generated_HydroPumpedStorage/">HydroPumpedStorage</a></li><li><a class="tocitem" href="../../model_library/generated_RenewableDispatch/">RenewableDispatch</a></li><li><a class="tocitem" href="../../model_library/generated_RenewableFix/">RenewableFix</a></li><li><a class="tocitem" href="../../model_library/generated_ThermalMultiStart/">ThermalMultiStart</a></li><li><a class="tocitem" href="../../model_library/generated_ThermalStandard/">ThermalStandard</a></li><li><a class="tocitem" href="../../model_library/generated_Source/">Source</a></li><li><a class="tocitem" href="../../model_library/generated_GenericBattery/">GenericBattery</a></li><li><a class="tocitem" href="../../model_library/regulation_device/">Regulation Device</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">Topology</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_Area/">Area</a></li><li><a class="tocitem" href="../../model_library/generated_LoadZone/">LoadZone</a></li><li><a class="tocitem" href="../../model_library/generated_Arc/">Arc</a></li><li><a class="tocitem" href="../../model_library/generated_Bus/">Bus</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">DynamicInjection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/dynamic_inverter/">Dynamic Inverter</a></li><li><a class="tocitem" href="../../model_library/dynamic_generator/">Dynamic Generator</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-6" type="checkbox"/><label class="tocitem" for="menuitem-6-6"><span class="docs-label">Service</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_AGC/">AGC</a></li><li><a class="tocitem" href="../../model_library/generated_StaticReserveNonSpinning/">StaticReserveNonSpinning</a></li><li><a class="tocitem" href="../../model_library/generated_VariableReserveNonSpinning/">VariableReserveNonSpinning</a></li><li><a class="tocitem" href="../../model_library/generated_Transfer/">Transfer</a></li><li><a class="tocitem" href="../../model_library/reserves/">Reserves</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-7" type="checkbox"/><label class="tocitem" for="menuitem-6-7"><span class="docs-label">Branch</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_Line/">Line</a></li><li><a class="tocitem" href="../../model_library/generated_MonitoredLine/">MonitoredLine</a></li><li><a class="tocitem" href="../../model_library/generated_PhaseShiftingTransformer/">PhaseShiftingTransformer</a></li><li><a class="tocitem" href="../../model_library/generated_TapTransformer/">TapTransformer</a></li><li><a class="tocitem" href="../../model_library/generated_Transformer2W/">Transformer2W</a></li><li><a class="tocitem" href="../../model_library/generated_HVDCLine/">HVDCLine</a></li><li><a class="tocitem" href="../../model_library/generated_VSCDCLine/">VSCDCLine</a></li><li><a class="tocitem" href="../../model_library/dynamic_branch/">Dynamic Lines</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-8" type="checkbox"/><label class="tocitem" for="menuitem-6-8"><span class="docs-label">DynamicGeneratorComponent</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_library/generated_AVR/">AVR</a></li><li><a class="tocitem" href="../../model_library/generated_Machine/">Machine</a></li><li><a class="tocitem" href="../../model_library/generated_PSS/">PSS</a></li><li><a class="tocitem" href="../../model_library/generated_Shaft/">Shaft</a></li><li><a class="tocitem" href="../../model_library/generated_TurbineGov/">TurbineGov</a></li></ul></li></ul></li><li><a class="tocitem" href="../../api/internal/">Internal API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model Developer</a></li><li class="is-active"><a href>Adding Types</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Adding Types</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-SIIP/PowerSystems.jl/blob/master/docs/src/model_developer/adding_types.md" title="Edit on GitHub"><span class="docs-icon fab">ï</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Adding-PowerSystems-Types"><a class="docs-heading-anchor" href="#Adding-PowerSystems-Types">Adding PowerSystems Types</a><a id="Adding-PowerSystems-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-PowerSystems-Types" title="Permalink"></a></h1><p>This page describes how developers should add types to PowerSystems. Refer to this <a href="https://nrel-siip.github.io/InfrastructureSystems.jl/latest/man/guide/#Component-structs">guide</a> first.</p><h2 id="Type-Hierarchy"><a class="docs-heading-anchor" href="#Type-Hierarchy">Type Hierarchy</a><a id="Type-Hierarchy-1"></a><a class="docs-heading-anchor-permalink" href="#Type-Hierarchy" title="Permalink"></a></h2><p>All structs that correlate to power system components must be subtypes of the <code>Component</code> abstract type. Browse its type hierachy to choose an appropriate supertype for your new struct.</p><h2 id="Auto-generating-Structs"><a class="docs-heading-anchor" href="#Auto-generating-Structs">Auto-generating Structs</a><a id="Auto-generating-Structs-1"></a><a class="docs-heading-anchor-permalink" href="#Auto-generating-Structs" title="Permalink"></a></h2><p>Most PowerSystems structs are auto-generated from the JSON descriptor file <code>src/descriptors/power_system_structs.json</code>. You can add your new struct here or write it manually.</p><p>If all you need is the basic struct definition and getter/setter functions then you will likely find the auto-generation helpful.</p><p>If you will need to write specialized functions for the type then you will probably want to write it manually.</p><p>Refer to this <a href="https://nrel-siip.github.io/InfrastructureSystems.jl/latest/man/guide/#Auto-Generation-of-component-structs">link</a> for more information.</p><h2 id="Interfaces"><a class="docs-heading-anchor" href="#Interfaces">Interfaces</a><a id="Interfaces-1"></a><a class="docs-heading-anchor-permalink" href="#Interfaces" title="Permalink"></a></h2><p>Some abstract types define required interface functions in docstring. Be sure to implement each of them for your new type.</p><p>Formalized documentation for each abstract type is TBD.</p><h2 id="Specialize-an-Existing-Type"><a class="docs-heading-anchor" href="#Specialize-an-Existing-Type">Specialize an Existing Type</a><a id="Specialize-an-Existing-Type-1"></a><a class="docs-heading-anchor-permalink" href="#Specialize-an-Existing-Type" title="Permalink"></a></h2><p>There are scenarios where you may want to make a new type that is identical to an existing type except for one attribute or behavior, and don&#39;t want to duplicate the entire existing type and methods. In programming languages that support inheritance you would derive a new class from the existing class and automatically inherit its fields and methods. Julia doesn&#39;t support that. However, you can achieve a similar result with a forwarding macro. The basic idea is that you include the existing type within your struct and then use a macro to automatically forward specific methods to that instance.</p><p>A few PowerSystems structs use the macro <code>InfrastructureSystems.@forward</code> to do this. Refer to the struct <code>RoundRotorQuadratic</code> for an example of how to use this.</p><h2 id="Custom-Rules"><a class="docs-heading-anchor" href="#Custom-Rules">Custom Rules</a><a id="Custom-Rules-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Rules" title="Permalink"></a></h2><p>Some types require special checks before they can be added to or removed from a system. One example is the case where a component includes another component that is also stored in the system. We must ensure that the parent component does not contain a reference to another component that is not already attached to the system.</p><p>Similarly, if the child object is removed from the system we must also remove the parent&#39;s reference to that child.</p><p>The source file <code>src/base.jl</code> provides functions that you can implement for your new type to manage these scenarios.</p><ul><li><code>check_component_addition(sys::System, component::Component)</code></li><li><code>handle_component_addition!(sys::System, component::Component)</code></li><li><code>check_component_removal(sys::System, component::Component)</code></li><li><code>handle_component_removal!(sys::System, component::Component)</code></li></ul><p>The functions <code>add_component!()</code> and <code>remove_component!()</code> call the check function before performing actions and then call the handle function afterwards. The default behavior of these functions is to do nothing. Implement versions that take your type in order to add your own checks or perform additional actions.</p><p>Beware of the condition where a custom method is already implemented for a supertype of your type.</p><p>Note that you can call the helper functions <code>is_attached(component, system)</code> and <code>throw_if_not_attached(component, system)</code>.</p><h2 id="JSON-Serialization"><a class="docs-heading-anchor" href="#JSON-Serialization">JSON Serialization</a><a id="JSON-Serialization-1"></a><a class="docs-heading-anchor-permalink" href="#JSON-Serialization" title="Permalink"></a></h2><p>PowerSystems provides functionality to serialize an entire system to a JSON file and then deserialize it back to a system. The main benefit is that deserializing is significantly faster than reconstructing the system from raw data files.</p><p>For most structs with basic types (numbers, strings, arrays and dictionaries of numbers and strings) the library used by PowerSystems can convert structs between Julia and JSON with no work required by the user.</p><p>In cases where a struct contains another PowerSystems component that is also stored in the system, extra work is required.  There are two reasons for this:</p><ol><li>We don&#39;t want to duplicate JSON representations of the same component.</li><li>The deserialization process needs to ensure that the parent component has a reference to the child component. It should not contain a different instance that is equivalent in content.</li></ol><p>To accomplish these goals PowerSystems stores the child component&#39;s UUID in the JSON object instead of its value. The deserialization process ensures that the child is deserialized first. When it deserializes the parent it looks up the child&#39;s UUID in a dictionary and stores a reference to the value.</p><p>PowerSystems implements this logic for many abstract types. For example, all subtypes of <code>Device</code> contain a <code>Bus</code>, and so PowerSystems solves this problem for all devices in one place.</p><p>It&#39;s likely that your new type will just work. Here&#39;s how you can test it:</p><pre><code class="language-julia">using PowerSystems

# Assume a system is built and stored in the variable sys.
to_json(sys, &quot;sys.json&quot;)

# Browse the JSON file to examine how PowerSystems stored your instance.
# This method requires installation of jq.
jq . sys.json | less

# Re-create the system and find your component.
sys2 = System(&quot;sys.json&quot;)
get_component(MyType, sys, &quot;component_name&quot;)</code></pre><p>If this doesn&#39;t work then we recommend you submit an issue on GitHub so that we can consult with you on the best way to solve the problem.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../extending_parsing/">Â« Extending Parsing</a><a class="docs-footer-nextpage" href="../../developer/style/">Style Guide Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 27 August 2020 02:26">Thursday 27 August 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
